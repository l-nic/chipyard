For initial setup (on top of the standard centos-chipyard VM setup and verilator installation), run this:

    sudo yum install libpcap-devel
    pip install 'fabric<2.0'
    cd ~
    git clone https://github.com/seladb/PcapPlusPlus
    cd PcapPlusPlus
    git checkout v19.12
    ./configure-linux (Enter n for both options)
    make -j16
    sudo make install
    cd ~/chipyard/sims/firesim
    git submodule update --init sim/firesim-lib/src/main/cc/lib/libdwarf
    git submodule update --init sim/firesim-lib/src/main/cc/lib/elfutils
    ./scripts/build-libelf.sh
    ./scripts/build-libdwarf.sh
    sudo ldconfig

Enable Password authentication for ssh:
* Open /etc/ssh/sshd_config and replace the line `PasswordAuthentication no` with `PasswordAuthentication yes` 
* service sshd restart

Create the logs directory:
* mkdir -p ~/chipyard/software/local_firesim/logs

To build the MIDAS-level simulator, run this:

    cd ~/chipyard/sims/firesim/sim
    make verilator-debug DESIGN=FireSim TARGET_CONFIG=DDR3FRFCFSLLC4MB_FireSimLNICQuadRocketConfig PLATFORM_CONFIG=F90MHz_BaseF1Config

To run the MIDAS-level simulator, run this:

    cd ~/chipyard/software/local_firesim
    python local_firesim.py 4 ../../tests/lnic-ping-latency.riscv

Notes:
If you want to change something that's normally a firesim param, modify the local_firesim.py script's invocation commands for the switch and MIDAS simulator.
The script will automatically pass in the assigned MAC and IP addresses as command-line arguments to the test RISC-V programs.
For now, always pass in '4' as the first argument to local_firesim.py. I'm working on giving it support for configurable numbers of sims, but right now it always launches 4. This means that if you only want run sim to run, you need to use the command-line arguments to figure out which one has a designated IP and force all the others to do nothing. (See lnic-ping-latency.c)
The script references the same switch used in chipyard/sims/firesim/target-design/switch via symbolic links, for all files except switchconfig.h, which is normally auto-generated by firesim but manually configured here.
The script automatically rebuilds the chipyard/tests and the switch directory at each run, so there's no need to compile those separately. Changes to any chisel code require a manual rebuild.
Logs are stored in the logs subdirectory, which also contains a symbolic link called "recent" that always points to the most recent log folder. You may want to periodically delete old log folers (or at least the waveform* entries), as each of these waveforms can be >5GB.
Four types of logs are saved:
1. uartlog* -- this is the output of all printf's from the risc-v binary, plus some outputs from the simulation infrastructure.
2. switchlog -- this is the output of all fprintf's from the switch, as you would see in firesim. This can be particularly useful for logging all sent and received packets and drop events. The local simulation supports only one switch.
3. niclog* -- this is the output of all printf's from the lnic.cc bridge driver. This can be a convenient backup debugging method if the switch is not functioning correctly but inserting more instructions into the risc-v binary is not possible.
4. waveform* -- this is the VCD waveform dump of each simulated nanoPU. Although you can open this waveform in gtkwave directly, it is significantly faster (and more space-efficient) to first run "vcd2fst waveform[n] waveform[n].fst" on each waveform you actually wish to view and then give gtkwave the fst file instead. This will allow you to delete the ~5GB VCD file and keep the ~300MB FST file. (It also reduces load time from multiple minutes to <10 seconds).
